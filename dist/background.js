({851:function(){var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(s,a){function c(e){try{r(n.next(e))}catch(e){a(e)}}function i(e){try{r(n.throw(e))}catch(e){a(e)}}function r(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,i)}r((n=n.apply(e,t||[])).next())}))};class t{static send({url:t,method:o,body:n=null,headers:s={}}){return e(this,void 0,void 0,(function*(){return yield(yield fetch(t,{method:o,body:n,headers:s})).text().then((e=>e))}))}}class o{static generateToken(){return e(this,void 0,void 0,(function*(){try{let e=null,o=yield t.send({method:"GET",url:"https://adsmanager.facebook.com/adsmanager/onboarding"});if(o&&o.indexOf('adAccountId: \\"')>0?e=o.split('adAccountId: \\"')[1].split('\\"')[0]:(o=yield t.send({method:"GET",url:"https://adsmanager.facebook.com/adsmanager/"}),o&&o.indexOf('adAccountId: \\"')>0&&(e=o.split('adAccountId: \\"')[1].split('\\"')[0])),!e)return{token:"ERR",adAccountId:null};o=yield t.send({method:"GET",url:`https://adsmanager.facebook.com/adsmanager/onboarding?act=${e}&breakdown_regrouping=0`});let n=null;return o&&o.indexOf("window.__accessToken")>0?n=o.split('window.__accessToken="')[1].split('"')[0]:(o=yield t.send({method:"GET",url:`https://adsmanager.facebook.com/adsmanager?act=${e}&breakdown_regrouping=1`}),o&&o.indexOf("window.__accessToken")>0&&(n=o.split('window.__accessToken="')[1].split('"')[0])),n||(n="ERR",e=null),{token:n,adAccountId:e}}catch(e){return{token:"ERR",adAccountId:null}}}))}}const n=t=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(`https://graph.facebook.com/v15.0/me/adaccounts?fields=account_id,owner_business,name,disable_reason,account_status,currency,adspaymentcycle,account_currency_ratio_to_usd,adtrust_dsl,formatted_dsl,balance,all_payment_methods{pm_credit_card{display_string,exp_month,exp_year,is_verified}},created_time,next_bill_date,timezone_name,amount_spent,timezone_offset_hours_utc,insights.date_preset(maximum){spend},userpermissions{user,role},owner,is_prepay_account,spend_cap&summary=true&limit=310&access_token=${t}`);return yield e.json()}catch(e){console.error(e)}})),s=t=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(`https://graph.facebook.com/v15.0/me?access_token=${t}`);return yield e.json()}catch(e){console.error(e)}})),a=t=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(`https://graph.facebook.com/v15.0/me?fields=accounts.limit(40){id,name,verification_status,is_published,ad_campaign,roles{id,%20tasks},is_promotable,is_restricted,parent_page,promotion_eligible,fan_count,followers_count,has_transitioned_to_new_page_experience,picture}&access_token=${t}`);return yield e.json()}catch(e){console.error(e)}})),c=t=>e(this,void 0,void 0,(function*(){try{const e=yield fetch(`https://graph.facebook.com/v15.0/me/businesses?fields=id,created_time,is_disabled_for_integrity_reasons,sharing_eligibility_status,allow_page_management_in_www,can_use_extended_credit,name,timezone_id,timezone_offset_hours_utc,verification_status,owned_ad_accounts{id,currency,timezone_offset_hours_utc,timezone_name}&access_token=${t}`),o=yield e.json();return console.log("getDataBM",o),o}catch(e){console.error(e)}}));chrome.runtime.onMessage.addListener(((t,i,r)=>{if("login_request"===t.action)return(()=>{e(this,void 0,void 0,(function*(){try{const t="myKey";chrome.storage.local.get([t],(i=>{const d=i[t];if(d)r(Object.assign({success:!0},d));else try{(()=>{e(this,void 0,void 0,(function*(){const e=yield o.generateToken(),i={token:e,accountId:yield s(e.token),data:yield n(e.token),dataPage:yield a(e.token),dataBM:yield c(e.token)};chrome.storage.local.set({[t]:i},(()=>{r(Object.assign({success:!0},i))}))}))})()}catch(e){r({success:!1,error:e.message})}}))}catch(e){r({success:!1,error:e.message})}}))})(),!0})),chrome.runtime.onMessage.addListener((function(e,t,o){"reload_storage"===e.action&&chrome.storage.local.clear((function(){console.log("Local storage cleared.")}))})),chrome.runtime.onInstalled.addListener((()=>{chrome.alarms.create("refreshToken",{periodInMinutes:120})})),chrome.alarms.onAlarm.addListener((t=>e(this,void 0,void 0,(function*(){if("refreshToken"===t.name){const e="myKey",t=yield o.generateToken();console.log("refreshToken",t);const i={token:t,accountId:yield s(t.token),data:yield n(t.token),dataPage:yield a(t.token),dataBM:yield c(t.token)};console.log("valuerefreshToken",i),chrome.storage.local.set({[e]:i},(()=>{console.log("ValueAlarm:",i)}))}})))),chrome.action.onClicked.addListener((()=>chrome.tabs.create({url:`chrome-extension://${chrome.runtime.id}/popup.html`,active:!0})))}})[851]();